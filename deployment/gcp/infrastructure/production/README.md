# Instructions for production deployment

0. Set up terraform backend as per `tf_backend/README.md`
1. Update `production.auto.tfvars` file
2. Initialize with `terraform init -backend-config=backend.conf`
3. `terraform apply`

   You will be prompted to enter your GCP project_id and service_account_email. The
   service account should have permission to run commands in the compute engine
   instance, pull images from the artifact registry, and Vertex AI APIs.

4. Go to GCP Secret Manager. For all secrets with `autogenerated: False` label, make
   sure to enter the correct values.
5. Before CI/CD scripts can run, make sure to

   1. Register an SSH key for your compute instance.

      ```shell
      ssh-keygen -t rsa -f ~/.ssh/aaq-key
      gcloud compute os-login ssh-keys add --key-file ~/.ssh/aaq-key.pub --project <GCP PROJECT ID>
      ```

   2. Save Github Secrets

   3. Link the static IP that's been created for the VM to your domain.
